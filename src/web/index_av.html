<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GenAI Calling with Video</title>
    <style>
    button {
        padding: 8px 16px;
    }

    /* Hide optional UI blocks while still keeping them in the DOM
       so client.js can access the elements without errors. */
    .hidden-option {
        display: none;
    }

    pre {
        overflow-x: hidden;
        overflow-y: auto;
    }

    video {
        width: 100%;
    }

    .option {
        margin-bottom: 8px;
    }

    #media {
        max-width: 1280px;
    }
    </style>
</head>
<body>

<h2>GenAI Calling with Video</h2>

<div class="option">
    <input id="include-video" checked="checked" type="checkbox"/>
    <label for="include-video"><strong>Include Video in Call</strong></label>
    <p style="font-size: 12px; color: #666;">
        When enabled, video will stream continuously during the entire call session.
        You can still do multi-round audio conversations using the recording buttons.
    </p>
</div>

<div class="option">
    <input id="enable-video-recording" type="checkbox"/>
    <label for="enable-video-recording"><strong>Enable Video Recording (for SSIM Analysis)</strong></label>
    <p style="font-size: 12px; color: #666;">
        When enabled, the receiver video stream will be saved for SSIM quality analysis.
        This records the WebRTC video stream to measure visual quality degradation during packet loss.
    </p>
</div>

<div class="option">
    <input id="use-prerecorded-video" type="checkbox"/>
    <label for="use-prerecorded-video"><strong>Use Pre-recorded Video</strong></label>
    <p style="font-size: 12px; color: #666;">
        When enabled, streams the pre-recorded video from the server instead of webcam. 
        This ensures reproducibility of the test.
    </p>
</div>

<div class="option">
    <input id="use-trickle-ice" type="checkbox"/>
    <label for="use-trickle-ice"><strong>Enable Trickle ICE (RFC 8838)</strong></label>
    <p style="font-size: 12px; color: #666;">
        STUN server (stun:stun.l.google.com:19302) is used by default. Enabling Trickle ICE (RFC 8838) accelerates 
        the process of establishing a communication session. This allows connectivity to begin immediately if both peers 
        already know each other's IP addresses, while waiting for the STUN server response in parallel. 
        Particularly beneficial in scenarios where STUN servers may be slow, unreachable, or blocked by firewalls.
    </p>
</div>

<!-- <h2>Options</h2> -->
<div class="option">
    <input id="use-datachannel" checked="checked" type="checkbox"/>
    <label for="use-datachannel">Use datachannel</label>
    <select id="datachannel-parameters">
        <option value='{"ordered": true}'>Ordered, reliable</option>
        <option value='{"ordered": false, "maxRetransmits": 0}'>Unordered, no retransmissions</option>
        <option value='{"ordered": false, "maxPacketLifetime": 500}'>Unordered, 500ms lifetime</option>
    </select>
</div>
<div class="option">
    <input id="use-audio" checked="checked" type="checkbox"/>
    <label for="use-audio">Use audio</label>
    <select id="audio-input">
        <option value="" selected>Default device</option>
    </select>
    <select id="audio-codec">
        <option value="default" selected>Default codecs</option>
        <option value="opus/48000/2">Opus</option>
        <option value="G722/8000">G722</option>
        <option value="PCMU/8000">PCMU</option>
        <option value="PCMA/8000">PCMA</option>
    </select>
</div>
<div class="option">
    <input id="use-video" checked="checked" type="checkbox"/>
    <label for="use-video">Use video</label>
    <select id="video-input">
        <option value="" selected>Default device</option>
    </select>
    <select id="video-resolution">
        <option value="">Default resolution</option>
        <option value="320x240">320x240</option>
        <option value="640x480">640x480</option>
        <option value="960x540">960x540</option>
        <option value="1280x720">1280x720</option>
        <option value="1920x1080" selected>1920x1080</option>
        <!-- <option value="2560x1440">2560x1440</option>
        <option value="3840x2160">3840x2160</option> -->
    </select>
    <select id="video-transform">
        <option value="none" selected>No transform</option>
        <option value="edges">Edge detection</option>
        <option value="cartoon">Cartoon effect</option>
        <option value="rotate">Rotate</option>
    </select>
    <select id="video-codec">
        <option value="default">Default codecs</option>
        <option value="VP8/90000">VP8</option>
        <option value="H264/90000" selected>H264</option>
    </select>
</div>
<div class="option" style="display: none;">
    <input id="use-stun" type="checkbox" checked="checked"/>
    <label for="use-stun">Use STUN server</label>
</div>


<button id="start"  onclick="startCall()">Start Call</button>

<button id="record" style="display:none" onclick="toggleRecord()">
   Start Recording (1)
</button>

<button id="stop"   style="display:none" onclick="stopCall()">Stop Call</button>

<div style="margin: 10px 0; padding: 10px; background-color: #f0f0f0; border-radius: 5px;">
    <strong>Instructions:</strong>
    <ul>
        <li>Check "Include Video" if you want video streaming during the call</li>
        <li>Click "Start Call" to establish connection (video streams continuously if enabled)</li>
        <li>Click "Start Recording" to begin streaming audio to server</li>
        <li>Speak your message</li>
        <li>Click "Stop & Transcribe" to end recording and get immediate transcription</li>
        <li>Repeat for multiple audio chunks while video keeps streaming</li>
    </ul>
</div>

<h2>State</h2>
<p>
    ICE gathering state: <span id="ice-gathering-state"></span>
</p>
<p>
    ICE connection state: <span id="ice-connection-state"></span>
</p>
<p>
    Signaling state: <span id="signaling-state"></span>
</p>

<div id="media" style="display: none">
    <h2>Media</h2>

    <audio id="audio" autoplay="true" style="display: none;"></audio>
    <div id="audio-status" style="display: none;">Waiting for audio...</div>
    <video id="video" autoplay="true" playsinline="true" style="display: none;"></video>
</div>

<h2>Data channel</h2>
<pre id="data-channel" style="height: 200px;"></pre>

<h2>SDP</h2>

<h3>Offer</h3>
<pre id="offer-sdp"></pre>

<h3>Answer</h3>
<pre id="answer-sdp"></pre>

<script src="client.js"></script>
</body>
</html>